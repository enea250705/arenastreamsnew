<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TM2J2414Z9"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-TM2J2414Z9', {
            page_title: '{{match.teamA}} vs {{match.teamB}} Live Stream',
            page_location: 'https://arenastreams.com/match/{{match.slug}}'
        });
    </script>
    
    <script>(s=>{s.dataset.zone='9879600',s.src='https://al5sm.com/tag.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{match.teamA}} vs {{match.teamB}} Live Stream {{match.competition}} {{match.date}} | ArenaStreams</title>
    <meta name="description" content="Watch {{match.teamA}} vs {{match.teamB}} live stream online free. {{match.competition}} match on {{match.date}}. HD quality streaming with multiple players available.">
    <meta name="keywords" content="{{match.teamA}}, {{match.teamB}}, live stream, {{match.competition}}, {{match.sport}}, online streaming">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://arenastreams.com/match/{{match.slug}}">
    
    <!-- Open Graph -->
    <meta property="og:title" content="{{match.teamA}} vs {{match.teamB}} Live Stream - {{match.competition}}">
    <meta property="og:description" content="Watch {{match.teamA}} vs {{match.teamB}} live stream online free. {{match.competition}} match on {{match.date}}.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://arenastreams.com/match/{{match.slug}}">
    <meta property="og:image" content="https://arenastreams.com/images/{{match.sport}}-og.jpg">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{match.teamA}} vs {{match.teamB}} Live Stream">
    <meta name="twitter:description" content="Watch {{match.teamA}} vs {{match.teamB}} live stream online free. {{match.competition}} match on {{match.date}}.">
    
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#ffcc00',
                        dark: '#1a1a1a',
                        darker: '#0f0f0f'
                    }
                }
            }
        }
    </script>
    
    <!-- Advanced Ad System -->
    <script src="/js/advanced-ads.js"></script>
    
    <!-- Service Worker for Ad Control -->
    <script>
        if ('serviceWorker' in navigator) {
            // Register original service worker (propeller tracking)
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('‚úÖ Propeller Service Worker registered:', registration);
                })
                .catch(error => {
                    console.log('‚ùå Propeller Service Worker registration failed:', error);
                });
            
            // Register custom ad protection service worker
            navigator.serviceWorker.register('/sw-custom.js')
                .then(registration => {
                    console.log('üõ°Ô∏è ArenaStreams Ad Protection SW registered:', registration);
                })
                .catch(error => {
                    console.log('‚ùå ArenaStreams Ad Protection SW registration failed:', error);
                });
        }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "SportsEvent",
        "name": "{{match.teamA}} vs {{match.teamB}}",
        "description": "Live streaming of {{match.teamA}} vs {{match.teamB}} {{match.competition}} match",
        "startDate": "{{match.date}}",
        "sport": "{{match.sport}}",
        "competitor": [
            {
                "@type": "SportsTeam",
                "name": "{{match.teamA}}"
            },
            {
                "@type": "SportsTeam", 
                "name": "{{match.teamB}}"
            }
        ],
        "location": {
            "@type": "VirtualLocation",
            "url": "https://arenastreams.com/match/{{match.slug}}"
        },
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock"
        }
    }
    </script>
</head>
<body class="bg-darker text-white min-h-screen">
    <!-- Header -->
    <header class="bg-dark border-b border-gray-800">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="/" class="text-2xl font-bold text-primary">üèüÔ∏è ArenaStreams</a>
                    <span class="text-gray-400 text-sm hidden md:block">Live Sports Streaming</span>
                </div>
                
                <!-- Desktop Navigation -->
                <nav class="hidden md:flex space-x-6">
                    <a href="/" class="text-gray-400 hover:text-primary transition-colors">Home</a>
                    <a href="/football" class="text-gray-400 hover:text-primary transition-colors">‚öΩ Football</a>
                    <a href="/basketball" class="text-gray-400 hover:text-primary transition-colors">üèÄ Basketball</a>
                    <a href="/tennis" class="text-gray-400 hover:text-primary transition-colors">üéæ Tennis</a>
                    <a href="/ufc" class="text-gray-400 hover:text-primary transition-colors">ü•ä UFC</a>
                    <a href="/rugby" class="text-gray-400 hover:text-primary transition-colors">üèâ Rugby</a>
                    <a href="/baseball" class="text-gray-400 hover:text-primary transition-colors">‚öæ Baseball</a>
                </nav>
                
                <!-- Mobile Hamburger Menu -->
                <button id="mobile-menu-btn" class="md:hidden text-gray-400 hover:text-primary transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="md:hidden hidden mt-4 pb-4">
                <nav class="flex flex-col space-y-3">
                    <a href="/" class="text-gray-400 hover:text-primary transition-colors py-2">Home</a>
                    <a href="/football" class="text-gray-400 hover:text-primary transition-colors py-2">‚öΩ Football</a>
                    <a href="/basketball" class="text-gray-400 hover:text-primary transition-colors py-2">üèÄ Basketball</a>
                    <a href="/tennis" class="text-gray-400 hover:text-primary transition-colors py-2">üéæ Tennis</a>
                    <a href="/ufc" class="text-gray-400 hover:text-primary transition-colors py-2">ü•ä UFC</a>
                    <a href="/rugby" class="text-gray-400 hover:text-primary transition-colors py-2">üèâ Rugby</a>
                    <a href="/baseball" class="text-gray-400 hover:text-primary transition-colors py-2">‚öæ Baseball</a>
                </nav>
            </div>
        </div>
    </header>

    <!-- Breadcrumbs -->
    <nav class="bg-dark border-b border-gray-800">
        <div class="container mx-auto px-4 py-3">
            <ol class="flex items-center space-x-2 text-sm">
                <li><a href="/" class="text-primary hover:text-yellow-400">Home</a></li>
                <li class="text-gray-400">/</li>
                <li><a href="/{{match.sport}}" class="text-primary hover:text-yellow-400 capitalize">{{match.sport}}</a></li>
                <li class="text-gray-400">/</li>
                <li><a href="/{{match.sport}}/{{match.competition}}" class="text-primary hover:text-yellow-400">{{match.competition}}</a></li>
                <li class="text-gray-400">/</li>
                <li class="text-white truncate">{{match.teamA}} vs {{match.teamB}}</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-2 sm:px-4 py-4 sm:py-8">
        <!-- Match Header - Optimized for Mobile -->
        <section class="mb-6 sm:mb-8">
            <!-- Team Names - Horizontal Layout -->
            <div class="flex items-center justify-between space-x-2 sm:space-x-4 mb-4 px-4">
                <!-- Team A -->
                <div class="flex items-center space-x-2 sm:space-x-3 min-w-0 flex-1">
                    {{#if match.teamABadge}}
                    <img src="{{match.teamABadge}}" alt="{{match.teamA}}" class="w-6 h-6 sm:w-12 sm:h-12 rounded-full flex-shrink-0">
                    {{/if}}
                    <span class="font-bold text-sm sm:text-2xl md:text-3xl truncate" title="{{match.teamA}}">{{match.teamA}}</span>
                </div>
                
                <!-- VS separator -->
                <span class="text-primary font-bold text-xs sm:text-lg md:text-xl flex-shrink-0">VS</span>
                
                <!-- Team B -->
                <div class="flex items-center space-x-2 sm:space-x-3 min-w-0 flex-1 justify-end">
                    <span class="font-bold text-sm sm:text-2xl md:text-3xl truncate" title="{{match.teamB}}">{{match.teamB}}</span>
                    {{#if match.teamBBadge}}
                    <img src="{{match.teamBBadge}}" alt="{{match.teamB}}" class="w-6 h-6 sm:w-12 sm:h-12 rounded-full flex-shrink-0">
                    {{/if}}
                </div>
            </div>
            
            <!-- Match Info -->
            <div class="text-center mb-4 px-4">
                <p class="text-lg sm:text-xl font-semibold text-primary">{{match.competition}}</p>
                <p class="text-gray-400 text-sm sm:text-base">{{match.date}}</p>
            </div>
            
            <!-- Live Status -->
            <div class="flex items-center justify-center space-x-2 text-xs sm:text-sm text-gray-400">
                <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                <span>Live Stream Available</span>
            </div>
        </section>

        <!-- Stream Player Section -->
        <section class="mb-8">
            <div class="bg-dark border border-gray-800 rounded-lg overflow-hidden">
                <!-- Server Buttons -->
                <div class="border-b border-gray-800 px-2 sm:px-4">
                    <div class="flex flex-wrap justify-center gap-2 py-3 sm:py-4" id="player-tabs-container">
                        <!-- Server buttons will be dynamically generated here -->
                    </div>
                </div>

            <!-- Player Content -->
            <div class="p-3 sm:p-6">
                <!-- Player Container -->
                <div id="player-container">
                    <div class="aspect-video bg-black rounded-lg overflow-hidden relative">
                        <div id="stream-placeholder" class="absolute inset-0 flex items-center justify-center bg-gray-900">
                            <div class="text-center px-4">
                                <div class="text-4xl sm:text-6xl text-gray-600 mb-4">üì∫</div>
                                <p class="text-gray-400 mb-4 text-sm sm:text-base">Ready to watch?</p>
                                <button id="play-btn" class="play-button bg-primary text-dark font-bold py-2 px-4 sm:py-3 sm:px-8 rounded-lg hover:bg-yellow-400 transition-colors text-sm sm:text-lg">
                                    ‚ñ∂Ô∏è Play Stream
                                </button>
                            </div>
                        </div>
                        <iframe id="stream-player" 
                                src="" 
                                frameborder="0" 
                                allowfullscreen
                                class="w-full h-full hidden">
                        </iframe>
                    </div>
                    
                    <!-- Player Controls -->
                    <div class="mt-3 sm:mt-4 text-center">
                        <div class="flex flex-col sm:flex-row gap-2 sm:gap-4 justify-center items-center">
                            <button id="play-pause-btn" class="resume-button bg-primary text-dark font-bold py-2 px-4 sm:py-2 sm:px-6 rounded-lg hover:bg-yellow-400 transition-colors text-sm sm:text-base hidden">
                                ‚è∏Ô∏è Pause
                            </button>
                            <button id="refresh-stream-btn" class="bg-gray-700 text-white font-bold py-2 px-4 sm:py-2 sm:px-6 rounded-lg hover:bg-gray-600 transition-colors text-sm sm:text-base">
                                üîÑ Refresh Stream
                            </button>
                        </div>
                        <p class="text-gray-400 text-xs sm:text-sm mt-2 px-4">
                            Click Play to start streaming. Ads may appear to support free service.
                        </p>
                    </div>
                </div>
                
                <!-- Banner Ad -->
                <div class="mt-4 sm:mt-6 text-center">
                    <div class="bg-gray-800 border border-gray-700 rounded-lg p-2 sm:p-4">
                        <p class="text-gray-400 text-xs sm:text-sm mb-2">Advertisement</p>
                        <div class="text-center">
                            <!-- Real Banner Ad -->
                            <iframe src="https://otieu.com/4/9880911" 
                                    width="728" height="90" 
                                    frameborder="0" 
                                    scrolling="no"
                                    style="max-width: 100%; height: auto;">
                            </iframe>
                            <p class="text-xs mt-2 text-gray-500">Advertisement</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Streaming Guide -->
        <section class="mb-8 max-w-4xl mx-auto">
            <div class="bg-dark border border-gray-800 rounded-lg p-6">
                <h2 class="text-2xl font-bold mb-4 text-primary">üì∫ How to Watch</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="flex items-start space-x-3">
                            <div class="bg-primary text-dark rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm">1</div>
                            <div>
                                <h3 class="font-semibold text-white mb-1">Choose Your Server</h3>
                                <p class="text-gray-400 text-sm">Click on any server button above to switch between different stream sources</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="bg-primary text-dark rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm">2</div>
                            <div>
                                <h3 class="font-semibold text-white mb-1">Stream Loads Automatically</h3>
                                <p class="text-gray-400 text-sm">No need to click play - the stream starts loading as soon as you enter</p>
                            </div>
                        </div>
                        <div class="flex items-start space-x-3">
                            <div class="bg-primary text-dark rounded-full w-8 h-8 flex items-center justify-center font-bold text-sm">3</div>
                            <div>
                                <h3 class="font-semibold text-white mb-1">Use Controls</h3>
                                <p class="text-gray-400 text-sm">Pause, resume, or refresh the stream using the control buttons below</p>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h4 class="font-semibold text-white mb-2">üí° Tips for Best Experience</h4>
                            <ul class="text-gray-400 text-sm space-y-2">
                                <li>‚Ä¢ Use Chrome or Firefox for best compatibility</li>
                                <li>‚Ä¢ Disable ad blockers if streams don't load</li>
                                <li>‚Ä¢ Try different servers if one doesn't work</li>
                                <li>‚Ä¢ Refresh the page if stream gets stuck</li>
                            </ul>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <h4 class="font-semibold text-white mb-2">‚ö° Quick Actions</h4>
                            <div class="flex flex-wrap gap-2">
                                <button onclick="window.location.reload()" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-colors">üîÑ Refresh Page</button>
                                <button onclick="document.getElementById('stream-player').src = document.getElementById('stream-player').src" class="bg-gray-700 hover:bg-gray-600 text-white px-3 py-1 rounded text-sm transition-colors">üì∫ Reload Stream</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Additional Information -->
        <section class="mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-dark border border-gray-800 rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Match Details</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Competition:</span>
                            <span class="text-white">{{match.competition}}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Date:</span>
                            <span class="text-white">{{match.date}}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Sport:</span>
                            <span class="text-white capitalize">{{match.sport}}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Status:</span>
                            <span class="text-green-500">Live</span>
                        </div>
                    </div>
                </div>

                <div class="bg-dark border border-gray-800 rounded-lg p-6">
                    <h3 class="text-xl font-bold mb-4">Streaming Info</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-400">Quality:</span>
                            <span class="text-white">HD</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Players:</span>
                            <span class="text-white">3 Available</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Ads:</span>
                            <span class="text-white">Minimal</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Mobile:</span>
                            <span class="text-green-500">Supported</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400">Cost:</span>
                            <span class="text-green-500">Free</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-dark border-t border-gray-800 mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center">
                <h4 class="text-xl font-bold text-primary mb-4">üèüÔ∏è ArenaStreams</h4>
                <p class="text-gray-400 text-sm mb-4">
                    Your ultimate destination for live sports streaming
                </p>
                <div class="flex justify-center space-x-6 text-sm text-gray-400">
                    <a href="/" class="hover:text-primary transition-colors">Home</a>
                    <a href="/football" class="hover:text-primary transition-colors">Football</a>
                    <a href="/basketball" class="hover:text-primary transition-colors">Basketball</a>
                    <a href="/tennis" class="hover:text-primary transition-colors">Tennis</a>
                    <a href="/ufc" class="hover:text-primary transition-colors">UFC</a>
                </div>
                <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400 text-sm">
                    <p>&copy; 2025 ArenaStreams. All rights reserved.</p>
                    
                    <!-- DMCA Notice -->
                    <div class="mt-6 p-4 bg-gray-800 rounded-lg border border-gray-700">
                        <h6 class="text-primary font-semibold mb-3">DMCA Copyright Notice</h6>
                        <div class="text-xs text-gray-300 leading-relaxed">
                            <p class="mb-2">
                                <strong>Digital Millennium Copyright Act (DMCA) Compliance:</strong>
                            </p>
                            <p class="mb-2">
                                ArenaStreams respects the intellectual property rights of others and expects our users to do the same. 
                                We do not host, store, or transmit any copyrighted content. All streams are provided by third-party sources 
                                and are not under our control.
                            </p>
                            <p class="mb-2">
                                <strong>If you believe your copyrighted work has been used in a way that constitutes copyright infringement, 
                                please provide the following information:</strong>
                            </p>
                            <ul class="text-left list-disc list-inside mb-2 space-y-1">
                                <li>Identification of the copyrighted work claimed to have been infringed</li>
                                <li>Identification of the material that is claimed to be infringing</li>
                                <li>Your contact information (name, address, phone number, email)</li>
                                <li>A statement that you have a good faith belief that use of the material is not authorized</li>
                                <li>A statement that the information is accurate and you are authorized to act on behalf of the copyright owner</li>
                            </ul>
                            <p class="mb-2">
                                <strong>DMCA Agent Contact:</strong><br>
                                Email: dmca@arenastreams.com<br>
                                Subject: DMCA Takedown Request
                            </p>
                            <p class="text-xs text-gray-400">
                                We will respond to valid DMCA notices within 24-48 hours and remove infringing content promptly.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    
    
    <!-- Ad Scripts -->
    <script>
        // Ad configuration (moved to DOMContentLoaded)

        // Check if user has reached popup limit
        function checkPopupLimit() {
            const stored = localStorage.getItem('arenastreams_popups_' + adConfig.sessionId);
            return stored ? parseInt(stored) : 0;
        }

        function updatePopupCount(count) {
            localStorage.setItem('arenastreams_popups_' + adConfig.sessionId, count.toString());
        }

        // Trigger popup ads
        function triggerPopups(count) {
            const currentCount = checkPopupLimit();
            if (currentCount >= adConfig.maxPopupsPerSession) {
                console.log('Maximum popups reached for this session');
                return;
            }

            for (let i = 0; i < count; i++) {
                if (currentCount + i < adConfig.maxPopupsPerSession) {
                    // Simulate popup ad (replace with real ad scripts)
                    setTimeout(() => {
                        const popup = window.open('about:blank', 'popup_' + i, 'width=400,height=300');
                        if (popup) {
                            popup.document.write(`
                                <html>
                                    <head><title>Advertisement</title></head>
                                    <body style="margin:0;padding:20px;font-family:Arial;">
                                        <h3>Advertisement</h3>
                                        <p>This is a placeholder for popup ads.</p>
                                        <p>In production, this would load real ad content.</p>
                                        <button onclick="window.close()">Close</button>
                                    </body>
                                </html>
                            `);
                        }
                    }, i * 1000);
                }
            }

            updatePopupCount(currentCount + count);
        }

        // Stream player functionality (variables moved to DOMContentLoaded)
        
        // Load real streams from Streamed.pk if available
        async function loadRealStreams() {
                try {
                if (window.match && window.match.sources && window.match.sources.length > 0) {
                    console.log('üîÑ Loading real streams from Streamed.pk...');
                    console.log(`üì° Found ${window.match.sources.length} sources:`, window.match.sources);
                    
                    const allStreams = [];
                    
                    // Fetch streams from ALL sources (like football.html does)
                    for (const source of window.match.sources) {
                        try {
                            console.log(`üì° Fetching stream for source: ${source.source}, id: ${source.id}`);
                            const response = await fetch(`/api/streamed/stream/${source.source}/${source.id}`);
                            
                            if (!response.ok) {
                                console.error(`‚ùå Failed to fetch streams for source ${source.source}: ${response.status}`);
                                continue;
                            }
                            
                            const data = await response.json();
                            console.log(`üìä Stream API response for ${source.source}:`, data);

                            // The API returns streams wrapped in 'value' array
                            if (data.value && Array.isArray(data.value) && data.value.length > 0) {
                                const sourceStreams = data.value.map(stream => ({
                                    ...stream,
                                    source: source.source
                                }));
                                allStreams.push(...sourceStreams);
                                console.log(`‚úÖ Added ${sourceStreams.length} streams from ${source.source}`);
                            } else if (Array.isArray(data) && data.length > 0) {
                                // Fallback for direct array response
                                const sourceStreams = data.map(stream => ({
                                    ...stream,
                                    source: source.source
                                }));
                                allStreams.push(...sourceStreams);
                                console.log(`‚úÖ Added ${sourceStreams.length} streams from ${source.source}`);
                            } else if (data.streams && data.streams.length > 0) {
                                // Fallback for different response format
                                const sourceStreams = data.streams.map(stream => ({
                                    ...stream,
                                    source: source.source
                                }));
                                allStreams.push(...sourceStreams);
                                console.log(`‚úÖ Added ${sourceStreams.length} streams from ${source.source}`);
                            } else {
                                console.log(`‚ö†Ô∏è No streams found for source ${source.source}`);
                            }
                        } catch (error) {
                            console.error(`‚ùå Error fetching streams from ${source.source}:`, error);
                        }
                    }
                    
                    // Limit to 20 streams maximum
                    const limitedStreams = allStreams.slice(0, 20);
                    window.match.embedUrls = limitedStreams.map(stream => stream.embedUrl);
                    
                    console.log(`üì∫ Total loaded ${limitedStreams.length} real streams from ${window.match.sources.length} sources:`, window.match.embedUrls);
                    
                    // Generate player tabs dynamically based on actual stream count
                    generatePlayerTabs(limitedStreams.length);
                    
                } else {
                    console.log('‚ö†Ô∏è No match sources available, using 20 default streams');
                    // Generate 20 default player tabs with fallback streams
                    generatePlayerTabs(20);
                    
                    // Create 20 fallback embed URLs
                    window.match.embedUrls = [
                        'https://streamed.pk/embed/1',
                        'https://streamed.pk/embed/2', 
                        'https://streamed.pk/embed/3',
                        'https://streamed.pk/embed/4',
                        'https://streamed.pk/embed/5',
                        'https://streamed.pk/embed/6',
                        'https://streamed.pk/embed/7',
                        'https://streamed.pk/embed/8',
                        'https://streamed.pk/embed/9',
                        'https://streamed.pk/embed/10',
                        'https://streamed.pk/embed/11',
                        'https://streamed.pk/embed/12',
                        'https://streamed.pk/embed/13',
                        'https://streamed.pk/embed/14',
                        'https://streamed.pk/embed/15',
                        'https://streamed.pk/embed/16',
                        'https://streamed.pk/embed/17',
                        'https://streamed.pk/embed/18',
                        'https://streamed.pk/embed/19',
                        'https://streamed.pk/embed/20'
                    ];
                }
                } catch (error) {
                    console.error('‚ùå Failed to load real streams:', error);
                    // Generate 20 default player tabs on error
                    generatePlayerTabs(20);
                    
                    // Create 20 fallback embed URLs for error case
                    window.match.embedUrls = [
                        'https://streamed.pk/embed/1',
                        'https://streamed.pk/embed/2', 
                        'https://streamed.pk/embed/3',
                        'https://streamed.pk/embed/4',
                        'https://streamed.pk/embed/5',
                        'https://streamed.pk/embed/6',
                        'https://streamed.pk/embed/7',
                        'https://streamed.pk/embed/8',
                        'https://streamed.pk/embed/9',
                        'https://streamed.pk/embed/10',
                        'https://streamed.pk/embed/11',
                        'https://streamed.pk/embed/12',
                        'https://streamed.pk/embed/13',
                        'https://streamed.pk/embed/14',
                        'https://streamed.pk/embed/15',
                        'https://streamed.pk/embed/16',
                        'https://streamed.pk/embed/17',
                        'https://streamed.pk/embed/18',
                        'https://streamed.pk/embed/19',
                        'https://streamed.pk/embed/20'
                    ];
                }
        }

        // Generate player tabs dynamically based on number of streams
        function generatePlayerTabs(streamCount, forceRegenerate = false) {
            const container = document.getElementById('player-tabs-container');
            if (!container) {
                console.log('‚ùå Player tabs container not found');
                return;
            }

            // Don't regenerate if tabs already exist and we're not forcing it
            if (!forceRegenerate && container.children.length > 0) {
                console.log(`üéÆ Tabs already exist (${container.children.length}), skipping regeneration`);
                return;
            }

            container.innerHTML = '';
            console.log(`üéÆ Generating ${streamCount} player tabs...`);

            for (let i = 1; i <= streamCount; i++) {
                const tab = document.createElement('button');
                const isActive = i === 1;
                // Mobile-friendly button styling with responsive classes
                tab.className = `player-tab px-2 py-1 sm:px-4 sm:py-2 mx-1 sm:mx-2 rounded-lg font-semibold transition-all duration-300 text-xs sm:text-sm ${isActive ? 'bg-primary text-dark shadow-lg transform scale-105' : 'bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white'}`;
                tab.dataset.player = i;
                tab.textContent = `S${i}`; // Shorter text for mobile
                container.appendChild(tab);
                
                console.log(`‚úÖ Created Server ${i} button${isActive ? ' (active)' : ''}`);
            }

            console.log(`üéÆ Generated ${streamCount} player tabs successfully`);
        }

        // Match data from server - with error handling
        let matchData;
        try {
            matchData = JSON.parse('{{json match}}');
        } catch (error) {
            console.error('‚ùå JSON parsing error:', error);
            console.log('Raw template output:', '{{json match}}');
            // Fallback to default data
            matchData = {
                id: 'default-match',
                teamA: 'Team A',
                teamB: 'Team B',
                competition: 'Match',
                date: new Date().toISOString(),
                slug: 'default-match',
                sources: []
            };
        }
        
        // Make match data available globally with error handling
        window.match = matchData || {
            id: 'default-match',
            teamA: 'Team A',
            teamB: 'Team B',
            competition: 'Match',
            date: new Date().toISOString(),
            slug: 'default-match',
            sources: []
        };
        
        console.log('üìä Match data loaded:', window.match);

        document.addEventListener('DOMContentLoaded', function() {

            const playBtn = document.getElementById('play-btn');
            const playPauseBtn = document.getElementById('play-pause-btn');
            const refreshBtn = document.getElementById('refresh-stream-btn');
            const playerContainer = document.getElementById('player-container');
            const streamPlayer = document.getElementById('stream-player');
            const streamPlaceholder = document.getElementById('stream-placeholder');
            
            let currentPlayer = 1;
            let embedUrls = [];
            let isStreamPlaying = false;
            let hasPlayedBefore = false;

            // Mobile menu functionality - robust fallback for production
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            
            console.log('üîç Match page - Mobile menu elements:', { mobileMenuBtn, mobileMenu });
            
            if (mobileMenuBtn && mobileMenu) {
                // Remove any existing listeners first
                const newMobileMenuBtn = mobileMenuBtn.cloneNode(true);
                mobileMenuBtn.parentNode.replaceChild(newMobileMenuBtn, mobileMenuBtn);
                
                // Add robust event listener
                newMobileMenuBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üì± Match - Mobile menu button clicked');
                    mobileMenu.classList.toggle('hidden');
                    console.log('üì± Match - Mobile menu hidden class:', mobileMenu.classList.contains('hidden'));
                });
                
                // Also add touch event for mobile devices
                newMobileMenuBtn.addEventListener('touchstart', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('üì± Match - Mobile menu button touched');
                    mobileMenu.classList.toggle('hidden');
                    console.log('üì± Match - Mobile menu hidden class:', mobileMenu.classList.contains('hidden'));
                });
                
                console.log('‚úÖ Match - Mobile menu fallback initialized with robust event listeners');
            } else {
                console.log('‚ùå Match - Mobile menu elements not found:', { 
                    mobileMenuBtn: !!mobileMenuBtn, 
                    mobileMenu: !!mobileMenu 
                });
            }

            // Initialize popup tracking from localStorage
            const sessionKey = 'arenastreams_popups_' + window.match.id;
            let popupCount = parseInt(localStorage.getItem(sessionKey) || '0');
            const maxPopups = 5;

            console.log(`üîÑ Initializing player tabs... Popup count: ${popupCount}/${maxPopups}`);

            // Generate default tabs first, then load real streams
            try {
            generatePlayerTabs(20); // Default 20 tabs
                console.log('‚úÖ Player tabs generated successfully');
            } catch (error) {
                console.error('‚ùå Error generating player tabs:', error);
            }
            
            try {
            loadRealStreams();
                console.log('‚úÖ Real streams loading initiated');
            } catch (error) {
                console.error('‚ùå Error loading real streams:', error);
            }
            
            // Auto-load streams when page loads (no ads triggered)
            setTimeout(() => {
                console.log('üöÄ Auto-loading streams on page load...');
                autoLoadStreams();
            }, 2000); // Wait 2 seconds for page to fully load

            // Real Ad popup logic with localStorage tracking - Made global for madurird integration
            window.triggerPopups = function triggerPopups(count) {
                if (popupCount >= maxPopups) {
                    console.log('üö´ Max popups reached for this session');
                    return;
                }

                const actualCount = Math.min(count, maxPopups - popupCount);
                console.log(`üì¢ Triggering ${actualCount} REAL ad popups (${popupCount}/${maxPopups})`);

                for (let i = 0; i < actualCount; i++) {
                    popupCount++;
                    
                    // Ad URLs will be handled by external scripts
                    // Removed direct ad links - now handled by external ad scripts
                    
                    // Popup ads are now handled by external ad scripts
                    console.log('üì¢ Popup ads will be triggered by external ad scripts');
                    
                    // Open popup with real ad content (network iframe + tag script)
                    const popup = window.open('about:blank', '_blank', 'width=800,height=600,scrollbars=yes,resizable=yes');
                    if (popup) {
                        popup.document.write(`
                            <html>
                              <head>
                                <title>Advertisement</title>
                                <meta name="viewport" content="width=device-width, initial-scale=1" />
                                <style>
                                  html,body{margin:0;height:100%;background:#000;color:#fff}
                                  .wrap{display:flex;align-items:center;justify-content:center;height:100%;flex-direction:column;gap:12px;padding:12px}
                                  .slot{width:100%;max-width:728px;min-height:90px;background:#111;border:1px solid #222;border-radius:8px;overflow:hidden}
                                  button{padding:10px 20px;background:#333;color:#fff;border:none;cursor:pointer;border-radius:6px}
                                </style>
                              </head>
                              <body>
                                <div class="wrap">
                                  <div class="slot">
                                    <iframe src="https://otieu.com/4/9880911" width="728" height="90" frameborder="0" scrolling="no" style="width:100%;height:90px;border:0;display:block"></iframe>
                                  </div>
                                  <div id="ad-slot" class="slot"></div>
                                  <button onclick="window.close()">Close</button>
                                </div>
                                <script>(function(){try{var s=document.createElement('script');s.src='https://al5sm.com/tag.min.js';s.dataset.zone='9879600';document.body.appendChild(s);}catch(e){}})();</script>
                              </body>
                            </html>
                        `);
                    }
                }

                // Save popup count to localStorage
                localStorage.setItem(sessionKey, popupCount.toString());
            }

            // Play button functionality (First/Second click logic)
            playBtn.addEventListener('click', function() {
                console.log('üé¨ Play button clicked');
                
                if (!hasPlayedBefore) {
                    // First click: Show overlay + trigger 3 popups
                    console.log('üé¨ First click - triggering 3 popups');
                    triggerPopups(3);
                    
                    // Show overlay message
                    streamPlaceholder.innerHTML = `
                        <div class="text-center">
                            <div class="text-6xl text-gray-600 mb-4">‚è∏Ô∏è</div>
                            <p class="text-gray-400 mb-4">Click Resume to continue</p>
                            <button id="resume-btn" class="bg-primary text-dark font-bold py-3 px-8 rounded-lg hover:bg-yellow-400 transition-colors text-lg">
                                ‚ñ∂Ô∏è Resume Stream
                            </button>
                        </div>
                    `;
                    
                    hasPlayedBefore = true;
                    
                    // Add resume button event listener
                    document.getElementById('resume-btn').addEventListener('click', function() {
                        console.log('üé¨ Resume button clicked - triggering 2 popups');
                        triggerPopups(2);
                        startStream();
                    });
                    
                } else {
                    // This shouldn't happen with proper UI flow
                    startStream();
                }
            });

            function startStream() {
                console.log('üöÄ Starting stream...');
                
                // Load and show stream
                loadStream().then(() => {
                    // Hide placeholder, show player
                    streamPlaceholder.style.display = 'none';
                    streamPlayer.classList.remove('hidden');
                    playPauseBtn.classList.remove('hidden');
                    isStreamPlaying = true;
                    
                    console.log('‚úÖ Stream started successfully');
                    console.log('üì∫ Stream player src:', streamPlayer.src);
                    console.log('üì∫ Stream player visible:', !streamPlayer.classList.contains('hidden'));
                }).catch(error => {
                    console.error('‚ùå Error starting stream:', error);
                    // Show error message
                    streamPlaceholder.innerHTML = `
                        <div class="text-center">
                            <div class="text-6xl text-red-500 mb-4">‚ùå</div>
                            <p class="text-red-400 mb-4">Stream failed to load</p>
                            <button onclick="location.reload()" class="bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-700 transition-colors text-lg">
                                üîÑ Retry
                            </button>
                        </div>
                    `;
                });
            }

            // Auto-load streams without triggering ads (for page load)
            function autoLoadStreams() {
                console.log('üöÄ Auto-loading streams (no ads)...');
                
                // Load streams without showing them yet
                loadStream().then(() => {
                    // Keep placeholder visible, but streams are loaded
                    console.log('‚úÖ Streams auto-loaded successfully');
                    console.log('üì∫ Stream player src:', streamPlayer.src);
                    console.log('üì∫ Streams ready - waiting for user to click play');
                    
                    // Update placeholder to show streams are ready
                    streamPlaceholder.innerHTML = `
                        <div class="text-center">
                            <div class="text-6xl text-green-500 mb-4">üì∫</div>
                            <p class="text-gray-400 mb-4">Streams ready!</p>
                            <p class="text-gray-500 text-sm">Click Play to start watching</p>
                            <button id="play-btn" class="bg-primary text-dark font-bold py-3 px-8 rounded-lg hover:bg-yellow-400 transition-colors text-lg mt-4">
                                ‚ñ∂Ô∏è Play Stream
                            </button>
                        </div>
                    `;
                    
                    // Re-attach play button event listener
                    document.getElementById('play-btn').addEventListener('click', function() {
                        console.log('üé¨ Play button clicked');
                        
                        if (!hasPlayedBefore) {
                            // First click: Show overlay + trigger 3 popups
                            console.log('üé¨ First click - triggering 3 popups');
                            triggerPopups(3);
                            
                            // Show overlay message
                            streamPlaceholder.innerHTML = `
                                <div class="text-center">
                                    <div class="text-6xl text-gray-600 mb-4">‚è∏Ô∏è</div>
                                    <p class="text-gray-400 mb-4">Click Resume to continue</p>
                                    <button id="resume-btn" class="bg-primary text-dark font-bold py-3 px-8 rounded-lg hover:bg-yellow-400 transition-colors text-lg">
                                        ‚ñ∂Ô∏è Resume Stream
                                    </button>
                                </div>
                            `;
                            
                            hasPlayedBefore = true;
                            
                            // Add resume button event listener
                            document.getElementById('resume-btn').addEventListener('click', function() {
                                console.log('üé¨ Resume button clicked - triggering 2 popups');
                                triggerPopups(2);
                                startStream();
                            });
                            
                        } else {
                            // This shouldn't happen with proper UI flow
                            startStream();
                        }
                    });
                    
                }).catch(error => {
                    console.error('‚ùå Error auto-loading streams:', error);
                    // Show error message
                    streamPlaceholder.innerHTML = `
                        <div class="text-center">
                            <div class="text-6xl text-red-500 mb-4">‚ùå</div>
                            <p class="text-red-400 mb-4">Stream failed to load</p>
                            <button onclick="location.reload()" class="bg-red-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-red-700 transition-colors text-lg">
                                üîÑ Retry
                            </button>
                        </div>
                    `;
                });
            }

            // Play/Pause button functionality (only after stream starts)
            playPauseBtn.addEventListener('click', function() {
                if (isStreamPlaying) {
                    // Pause stream
                    streamPlayer.classList.add('hidden');
                    streamPlaceholder.style.display = 'flex';
                    streamPlaceholder.innerHTML = `
                        <div class="text-center">
                            <div class="text-6xl text-gray-600 mb-4">‚è∏Ô∏è</div>
                            <p class="text-gray-400">Stream paused</p>
                        </div>
                    `;
                    playPauseBtn.innerHTML = '‚ñ∂Ô∏è Resume';
                    isStreamPlaying = false;
                } else {
                    // Resume stream
                    streamPlayer.classList.remove('hidden');
                    streamPlaceholder.style.display = 'none';
                    playPauseBtn.innerHTML = '‚è∏Ô∏è Pause';
                    isStreamPlaying = true;
                }
            });

            // Refresh stream button
            refreshBtn.addEventListener('click', function() {
                console.log('üîÑ Refreshing stream...');
                loadStream();
            });


            // Player tab switching (using event delegation for dynamic tabs)
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('player-tab')) {
                    console.log('üéØ Player tab clicked:', e.target.dataset.player);
                    
                    // Update active tab
                    const allTabs = document.querySelectorAll('.player-tab');
                    allTabs.forEach(tab => {
                        tab.classList.remove('bg-primary', 'text-dark', 'shadow-lg', 'scale-105');
                        tab.classList.add('bg-gray-700', 'text-gray-300');
                    });
                    
                    e.target.classList.remove('bg-gray-700', 'text-gray-300');
                    e.target.classList.add('bg-primary', 'text-dark', 'shadow-lg', 'scale-105');
                    
                    // Update current player
                    currentPlayer = parseInt(e.target.dataset.player);
                    console.log('üîÑ Switched to player:', currentPlayer);
                    
                    // Reload stream if player is visible
                    if (!streamPlayer.classList.contains('hidden')) {
                        console.log('üîÑ Stream is visible, reloading with new player:', currentPlayer);
                        loadStream();
                    } else {
                        console.log('üîÑ Stream is hidden, not reloading');
                    }
                }
            });

            async function loadStream() {
                console.log('üé¨ Starting stream load...');
                
                try {
                    // Load real streams from Streamed.pk
                    await loadRealStreams();
                    
                    const streams = window.match.embedUrls || embedUrls;
                    console.log('üì∫ Available streams:', streams);
                    
                    if (streams && streams.length > 0) {
                        const streamUrl = streams[currentPlayer - 1] || streams[0];
                        console.log(`üì∫ Loading stream ${currentPlayer}: ${streamUrl}`);
                        streamPlayer.src = streamUrl;
                        console.log('‚úÖ Stream loaded');
                    } else {
                        console.log('‚ö†Ô∏è No real streams available - checking match data:', window.match);
                        console.log('‚ö†Ô∏è Match sources:', window.match?.sources);
                        
                        // Show a message instead of YouTube videos
                        streamPlaceholder.innerHTML = `
                            <div class="text-center">
                                <div class="text-6xl text-yellow-500 mb-4">üì∫</div>
                                <p class="text-gray-400 mb-4">Real streams loading...</p>
                                <p class="text-gray-500 text-sm">Match: ${window.match?.teamA} vs ${window.match?.teamB}</p>
                                <p class="text-gray-500 text-sm">Sources: ${window.match?.sources?.length || 0}</p>
                                <button onclick="location.reload()" class="bg-primary text-dark font-bold py-2 px-4 rounded-lg hover:bg-yellow-400 transition-colors mt-4">
                                    üîÑ Retry Loading Streams
                                </button>
                            </div>
                        `;
                        console.log('üì∫ Showing stream loading message instead of YouTube videos');
                    }
                } catch (error) {
                    console.error('‚ùå Error in loadStream:', error);
                    // Show error message instead of YouTube video
                    streamPlaceholder.innerHTML = `
                        <div class="text-center">
                            <div class="text-6xl text-red-500 mb-4">‚ùå</div>
                            <p class="text-red-400 mb-4">Stream loading failed</p>
                            <p class="text-gray-500 text-sm">Error: ${error.message}</p>
                            <button onclick="location.reload()" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 transition-colors mt-4">
                                üîÑ Retry
                            </button>
                        </div>
                    `;
                    console.log('üì∫ Showing error message instead of YouTube video');
                }
            }
        });
    </script>

    <!-- Main JavaScript -->
    <script src="/js/app.min.js"></script>
    <script>
      // Ensure no stale service workers interfere with streaming
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(regs => {
          regs.forEach(r => r.unregister().catch(()=>{}));
        });
      }
      
      if (!window.ArenaStreams) {
        document.write('<script src="/js/main.js"><\\/script>');
      }
    </script>
</body>
</html>
